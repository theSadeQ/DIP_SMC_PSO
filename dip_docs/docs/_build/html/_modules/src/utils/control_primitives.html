<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.utils.control_primitives &#8212; DIP_SMC_PSO Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=fb9458d3" />
    <script src="../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DIP_SMC_PSO Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">src.utils.control_primitives</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for src.utils.control_primitives</h1><div class="highlight"><pre>
<span></span><span class="c1">#==========================================================================================\\</span>
<span class="c1">#========================== src/utils/control_primitives.py ==========================\\</span>
<span class="c1">#==========================================================================================\\</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Positivity utilities</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="require_positive">
<a class="viewcode-back" href="../../../api/utils/control_primitives.html#src.utils.control_primitives.require_positive">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">require_positive</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_zero</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that a numeric value is positive (or non‑negative).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : float or int or None</span>
<span class="sd">        The numeric quantity to validate.</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the parameter (used in the error message).</span>
<span class="sd">    allow_zero : bool, optional</span>
<span class="sd">        When True, a value of exactly zero is allowed; otherwise values must</span>
<span class="sd">        be strictly greater than zero.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The validated value cast to ``float``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If ``value`` is ``None``, not a finite number, or does not satisfy</span>
<span class="sd">        the positivity requirement.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Many control gains and time constants must be positive to ensure</span>
<span class="sd">    stability in sliding‑mode and adaptive control laws【462167782799487†L186-L195】.</span>
<span class="sd">    Centralising positivity checks via this helper reduces duplicated logic</span>
<span class="sd">    across controllers and configuration validators.  Callers may still</span>
<span class="sd">    choose to perform their own validation before construction, but using</span>
<span class="sd">    this helper ensures consistent error messages and thresholds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be a finite number; got </span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">allow_zero</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be ≥ 0; got </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be &gt; 0; got </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span></div>


<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Range validation utilities</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="require_in_range">
<a class="viewcode-back" href="../../../api/utils/control_primitives.html#src.utils.control_primitives.require_in_range">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">require_in_range</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">minimum</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">maximum</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">allow_equal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that a numeric value lies within a closed or open interval.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : float or int or None</span>
<span class="sd">        The numeric quantity to validate.</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the parameter (used in the error message).</span>
<span class="sd">    minimum : float</span>
<span class="sd">        Lower bound of the allowed interval.</span>
<span class="sd">    maximum : float</span>
<span class="sd">        Upper bound of the allowed interval.</span>
<span class="sd">    allow_equal : bool, optional</span>
<span class="sd">        If True (default) the bounds are inclusive; if False the value</span>
<span class="sd">        must satisfy ``minimum &lt; value &lt; maximum``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The validated value cast to ``float``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If ``value`` is ``None``, not finite, or lies outside the</span>
<span class="sd">        specified interval.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Range constraints arise frequently in control law design; for</span>
<span class="sd">    example, a controllability threshold should be positive but small,</span>
<span class="sd">    whereas adaptation gains must lie within finite bounds to ensure</span>
<span class="sd">    stability【462167782799487†L186-L195】.  Centralising range checks</span>
<span class="sd">    avoids duplicating logic across the project and produces uniform</span>
<span class="sd">    error messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be a finite number; got </span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">allow_equal</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">minimum</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be in the interval [</span><span class="si">{</span><span class="n">minimum</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">maximum</span><span class="si">}</span><span class="s2">]; got </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">minimum</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">maximum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must satisfy </span><span class="si">{</span><span class="n">minimum</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">maximum</span><span class="si">}</span><span class="s2">; got </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span></div>


<div class="viewcode-block" id="saturate">
<a class="viewcode-back" href="../../../api/utils/control_primitives.html#src.utils.control_primitives.saturate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">saturate</span><span class="p">(</span>
    <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;tanh&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Continuous approximation of sign(sigma) within a boundary layer.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        sigma: Sliding surface value(s).</span>
<span class="sd">        epsilon: Boundary-layer half-width in σ-space (must be &gt; 0).  # ε is the half-width in σ-space.</span>
<span class="sd">        method: &quot;tanh&quot; (default) uses tanh(sigma/epsilon);</span>
<span class="sd">                &quot;linear&quot; uses clip(sigma/epsilon, -1, 1).</span>
<span class="sd">    Returns:</span>
<span class="sd">        Same shape as `sigma`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The boundary layer width ``epsilon`` should be chosen based on the</span>
<span class="sd">    expected amplitude of measurement noise and the desired steady‑state</span>
<span class="sd">    accuracy.  A larger ``epsilon`` reduces chattering but introduces</span>
<span class="sd">    a finite steady‑state error; conversely, a smaller ``epsilon`` reduces</span>
<span class="sd">    error but may increase high‑frequency switching【538884328193976†L412-L423】.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError</span>
<span class="sd">            If ``epsilon &lt;= 0`` or an unknown ``method`` is provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">epsilon</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;boundary layer epsilon must be positive&quot;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tanh&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="c1"># Warn users that the linear saturation approximates sign(sigma) poorly</span>
        <span class="c1"># near zero.  A piecewise‑linear approximation yields a sharp transition</span>
        <span class="c1"># at the boundary layer and can introduce larger steady‑state errors.</span>
        <span class="c1"># Sliding‑mode control theory recommends smooth approximations such</span>
        <span class="c1"># as tanh to mitigate chattering【676964782857750†L146-L149】.</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;linear&#39; switching method implements a piecewise‑linear saturation, &quot;</span>
            <span class="s2">&quot;which approximates the sign function poorly near zero and can degrade &quot;</span>
            <span class="s2">&quot;chattering performance.  Consider using &#39;tanh&#39; for smoother control.&quot;</span><span class="p">,</span>
            <span class="ne">RuntimeWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unknown saturation method: </span><span class="si">{</span><span class="n">method</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DIP_SMC_PSO Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">src.utils.control_primitives</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Research Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>